# ЁЯФД activeShopId Implementation - Staff & Owner Data Separation

## тЬЕ рж╕ржорзНржкржирзНржи рж╣ржпрж╝рзЗржЫрзЗ

ржПржЦржи рж╕рзНржЯрж╛ржл рж▓ржЧржЗржи ржХрж░рж▓рзЗ **ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛** ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗ, ржирж┐ржЬрзЗрж░ ржбрзЗржЯрж╛ ржиржпрж╝ред

---

## ЁЯОп ржХрзА ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

### **рзз. js/auth.js**
- `localStorage.setItem('activeShopId', ...)` ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- **ржорж╛рж▓рж┐ржХ рж▓ржЧржЗржи ржХрж░рж▓рзЗ:** `activeShopId = user.uid` (ржирж┐ржЬрзЗрж░ ржЖржЗржбрж┐)
- **рж╕рзНржЯрж╛ржл рж▓ржЧржЗржи ржХрж░рж▓рзЗ:** `activeShopId = staffData.shopId` (ржорж╛рж▓рж┐ржХрзЗрж░ ржЖржЗржбрж┐)

```javascript
// рж╕рзНржЯрж╛ржлрзЗрж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ
localStorage.setItem('activeShopId', staffData.shopId); // ржорж╛рж▓рж┐ржХрзЗрж░ ржЖржЗржбрж┐

// ржорж╛рж▓рж┐ржХрзЗрж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ
localStorage.setItem('activeShopId', user.uid); // ржирж┐ржЬрзЗрж░ ржЖржЗржбрж┐
```

### **рзи. js/shop-helper.js**
- `getActiveShopId()` ржлрж╛ржВрж╢ржи ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- ржПржЦржи `localStorage.getItem('activeShopId')` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ

```javascript
export function getActiveShopId() {
    const shopId = localStorage.getItem('activeShopId');
    if (!shopId) {
        window.location.href = '../index.html';
        return null;
    }
    return shopId;
}
```

---

## ЁЯУЛ ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ

### **ржорж╛рж▓рж┐ржХ рж▓ржЧржЗржи ржХрж░рж▓рзЗ:**
```
User: keshabsarkar2018@gmail.com
activeShopId: user.uid (ржирж┐ржЬрзЗрж░ ржЖржЗржбрж┐)
Role: owner
```
тЖТ ржирж┐ржЬрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦржмрзЗ

### **рж╕рзНржЯрж╛ржл рж▓ржЧржЗржи ржХрж░рж▓рзЗ:**
```
User: staff1@myshop.com
activeShopId: staffData.shopId (ржорж╛рж▓рж┐ржХрзЗрж░ ржЖржЗржбрж┐)
Role: cashier/manager
```
тЖТ ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦржмрзЗ

---

## ЁЯФз ржЕржирзНржпрж╛ржирзНржп ржлрж╛ржЗрж▓рзЗ ржХрзА ржХрж░рждрзЗ рж╣ржмрзЗ

ржЖржкржирж╛рж░ рж╕ржм JS ржлрж╛ржЗрж▓рзЗ ржпрзЗржЦрж╛ржирзЗ `auth.currentUser.uid` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, рж╕рзЗржЦрж╛ржирзЗ `activeShopId` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред

### **ржЙржжрж╛рж╣рж░ржг (dashboard.js-ржП ржЗрждрж┐ржоржзрзНржпрзЗ ржХрж░рж╛ ржЖржЫрзЗ):**

```javascript
// тЭМ ржкрзБрж░ржирзЛ ржХрзЛржб
const salesRef = collection(db, 'shops', auth.currentUser.uid, 'sales');

// тЬЕ ржирждрзБржи ржХрзЛржб
const activeShopId = getActiveShopId();
const salesRef = collection(db, 'shops', activeShopId, 'sales');
```

---

## ЁЯУВ ржпрзЗ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╣ржмрзЗ

ржирж┐ржЪрзЗрж░ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛрждрзЗ `auth.currentUser.uid` ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рзЗ `activeShopId` ржжрж┐ржпрж╝рзЗ рж░рж┐ржкрзНрж▓рзЗрж╕ ржХрж░рзБржи:

### тЬЕ **ржЗрждрж┐ржоржзрзНржпрзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ:**
- [x] `js/auth.js`
- [x] `js/shop-helper.js`
- [x] `js/dashboard.js` (ржЗрждрж┐ржоржзрзНржпрзЗ `getActiveShopId()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗ)

### ЁЯФД **ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╣ржмрзЗ:**
- [ ] `billing/billing.js`
- [ ] `inventory/inventory.js`
- [ ] `expense/expense.js`
- [ ] `add-product/add-product.js`
- [ ] `sales-report/report.js`
- [ ] `sales-report/profit-loss.js`
- [ ] `advance-booking/booking.js`
- [ ] `shop-details/shop-details.js`
- [ ] `purchase-record/purchase-record.js`
- [ ] `purchase-record/purchase-dashboard.js`

---

## ЁЯЫая╕П ржжрзНрж░рзБржд ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржЙржкрж╛ржпрж╝

### **ржкржжрзНржзрждрж┐ рзз: Find & Replace (рж╕ржмржЪрзЗржпрж╝рзЗ рж╕рж╣ржЬ)**

1. VS Code-ржП `Ctrl + Shift + F` (ржмрж╛ `Cmd + Shift + F`) ржЪрж╛ржкрзБржи
2. **Search:** `auth.currentUser.uid`
3. **Replace:** `activeShopId`
4. ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗ ржЪрзЗржХ ржХрж░рзЗ Replace ржХрж░рзБржи

### **ржкржжрзНржзрждрж┐ рзи: ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐**

ржкрзНрж░рждрж┐ржЯрж┐ JS ржлрж╛ржЗрж▓рзЗрж░ рж╢рзБрж░рзБрждрзЗ:

```javascript
import { getActiveShopId } from '../js/shop-helper.js';

let activeShopId = null;

onAuthStateChanged(auth, (user) => {
    if (user) {
        activeShopId = getActiveShopId();
        if (activeShopId) {
            // ржЖржкржирж╛рж░ ржорзЗржЗржи ржлрж╛ржВрж╢ржи ржХрж▓ ржХрж░рзБржи
            loadData();
        }
    } else {
        window.location.href = '../index.html';
    }
});
```

рждрж╛рж░ржкрж░ рж╕ржм ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ `auth.currentUser.uid` ржПрж░ ржмржжрж▓рзЗ `activeShopId` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

---

## ЁЯзк ржЯрзЗрж╕рзНржЯрж┐ржВ ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

### **ржорж╛рж▓рж┐ржХ рж╣рж┐рж╕рзЗржмрзЗ:**
- [ ] рж▓ржЧржЗржи ржХрж░рзБржи
- [ ] Dashboard-ржП ржирж┐ржЬрзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Billing, Inventory, Sales Report рж╕ржм ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ ржирж┐ржЬрзЗрж░ ржбрзЗржЯрж╛

### **рж╕рзНржЯрж╛ржл рж╣рж┐рж╕рзЗржмрзЗ:**
- [ ] рж╕рзНржЯрж╛ржл ржЖржЗржбрж┐ ржжрж┐ржпрж╝рзЗ рж▓ржЧржЗржи ржХрж░рзБржи
- [ ] Dashboard-ржП **ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛** ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Billing ржХрж░рж▓рзЗ ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗ рж╕рзЗржн рж╣ржЪрзНржЫрзЗ
- [ ] Inventory ржжрзЗржЦрж▓рзЗ ржорж╛рж▓рж┐ржХрзЗрж░ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ

---

## тЭУ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи

### **рж╕ржорж╕рзНржпрж╛: "No active shop ID found"**
**рж╕ржорж╛ржзрж╛ржи:** 
1. рж▓ржЧржЖржЙржЯ ржХрж░рзБржи
2. ржкрзБржирж░рж╛ржпрж╝ рж▓ржЧржЗржи ржХрж░рзБржи
3. `localStorage` ржХрзНрж▓рж┐ржпрж╝рж╛рж░ рж╣ржпрж╝рзЗ ржирждрзБржи `activeShopId` рж╕рзЗржЯ рж╣ржмрзЗ

### **рж╕ржорж╕рзНржпрж╛: рж╕рзНржЯрж╛ржл ржирж┐ржЬрзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦржЫрзЗ, ржорж╛рж▓рж┐ржХрзЗрж░ ржиржпрж╝**
**рж╕ржорж╛ржзрж╛ржи:**
1. `staff_mapping` ржХрж╛рж▓рзЗржХрж╢ржирзЗ `shopId` рж╕ржарж┐ржХ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи
2. Browser Console-ржП `localStorage.getItem('activeShopId')` ржЪрзЗржХ ржХрж░рзБржи
3. ржорж╛рж▓рж┐ржХрзЗрж░ UID ржПрж░ рж╕рж╛ржерзЗ ржорж┐рж▓ржЫрзЗ ржХрж┐ржирж╛ ржжрзЗржЦрзБржи

### **рж╕ржорж╕рзНржпрж╛: ржХрзЛржирзЛ ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ ржирж╛**
**рж╕ржорж╛ржзрж╛ржи:**
1. Browser Console ржЦрзБрж▓рзБржи
2. `activeShopId` undefined ржХрж┐ржирж╛ ржжрзЗржЦрзБржи
3. рж╕рзЗржЗ ржлрж╛ржЗрж▓рзЗ `getActiveShopId()` ржЗржоржкрзЛрж░рзНржЯ ржХрж░рж╛ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи

---

## ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк

1. **рж╕ржм ржлрж╛ржЗрж▓ ржЖржкржбрзЗржЯ ржХрж░рзБржи** (ржЙржкрж░рзЗрж░ рж▓рж┐рж╕рзНржЯ ржЕржирзБржпрж╛ржпрж╝рзА)
2. **ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи** (ржорж╛рж▓рж┐ржХ ржПржмржВ рж╕рзНржЯрж╛ржл ржЙржнржпрж╝ рж╣рж┐рж╕рзЗржмрзЗ)
3. **Firestore Security Rules ржЖржкржбрзЗржЯ ржХрж░рзБржи** (ржпрж╛рждрзЗ рж╕рзНржЯрж╛ржл рж╢рзБржзрзБ рждрж╛рж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░рзЗ)

---

**рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗржи:** Amazon Q Developer  
**рждрж╛рж░рж┐ржЦ:** рзирзжрзирзл-рзжрзз-рззрзл
