# тЬЕ activeShopId Implementation - рж╕ржорзНржкрзВрж░рзНржг рж╣ржпрж╝рзЗржЫрзЗ!

## ЁЯОЙ рж╕ржлрж▓ржнрж╛ржмрзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

ржПржЦржи **рж╕рзНржЯрж╛ржл рж▓ржЧржЗржи ржХрж░рж▓рзЗ ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛** ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗ ржПржмржВ рж╕ржм ржЕржкрж╛рж░рзЗрж╢ржи ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗ рж╣ржмрзЗред

---

## тЬЕ ржЖржкржбрзЗржЯ ржХрж░рж╛ ржлрж╛ржЗрж▓рзЗрж░ рждрж╛рж▓рж┐ржХрж╛

### **рзз. Core Files (ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ ржЖржкржбрзЗржЯ ржХрж░рж╛)**
- [x] `js/auth.js` - рж▓ржЧржЗржи рж╕ржоржпрж╝ `activeShopId` рж╕рзЗржн ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
- [x] `js/shop-helper.js` - `getActiveShopId()` ржлрж╛ржВрж╢ржи ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `js/dashboard.js` - ржЗрждрж┐ржоржзрзНржпрзЗ `getActiveShopId()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗ

### **рзи. Main Application Files (ржЕржЯрзЛржорзЗржЯрж┐ржХ ржЖржкржбрзЗржЯ ржХрж░рж╛)**
- [x] `billing/billing.js` - ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `inventory/inventory.js` - ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `expense/expense.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `add-product/add-product.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `sales-report/report.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `sales-report/profit-loss.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `advance-booking/booking.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `shop-details/shop-details.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `purchase-record/purchase-record.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [x] `purchase-record/purchase-dashboard.js` - sed ржХржорж╛ржирзНржб ржжрж┐ржпрж╝рзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

---

## ЁЯФД ржХрзА ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

### **ржкрзБрж░ржирзЛ ржХрзЛржб:**
```javascript
let currentUserId = null;

onAuthStateChanged(auth, (user) => {
    if (user) {
        currentUserId = user.uid;
        loadData();
    }
});

// ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рж╛рж░ рж╕ржоржпрж╝
const salesRef = collection(db, 'shops', currentUserId, 'sales');
```

### **ржирждрзБржи ржХрзЛржб:**
```javascript
let activeShopId = null;

onAuthStateChanged(auth, (user) => {
    if (user) {
        activeShopId = localStorage.getItem('activeShopId');
        if (activeShopId) {
            loadData();
        } else {
            window.location.href = '../index.html';
        }
    }
});

// ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рж╛рж░ рж╕ржоржпрж╝
const salesRef = collection(db, 'shops', activeShopId, 'sales');
```

---

## ЁЯОп ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ

### **ржорж╛рж▓рж┐ржХ рж▓ржЧржЗржи ржХрж░рж▓рзЗ:**
```
User: keshabsarkar2018@gmail.com
activeShopId: user.uid (ржирж┐ржЬрзЗрж░ ржЖржЗржбрж┐)
тЖТ ржирж┐ржЬрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦржмрзЗ ржПржмржВ ржЕржкрж╛рж░рзЗрж╢ржи ржХрж░ржмрзЗ
```

### **рж╕рзНржЯрж╛ржл (ржжрж┐ржкрж╛) рж▓ржЧржЗржи ржХрж░рж▓рзЗ:**
```
User: dipa@myshop.com
activeShopId: ржорж╛рж▓рж┐ржХрзЗрж░ UID (staff_mapping ржерзЗржХрзЗ)
тЖТ ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦржмрзЗ ржПржмржВ ржЕржкрж╛рж░рзЗрж╢ржи ржХрж░ржмрзЗ
```

---

## ЁЯзк ржЯрзЗрж╕рзНржЯрж┐ржВ ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

### **ржорж╛рж▓рж┐ржХ рж╣рж┐рж╕рзЗржмрзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи:**
- [ ] рж▓ржЧржЗржи ржХрж░рзБржи
- [ ] Dashboard ржжрзЗржЦрзБржи - ржирж┐ржЬрзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Billing ржХрж░рзБржи - ржирж┐ржЬрзЗрж░ ржжрзЛржХрж╛ржирзЗ рж╕рзЗржн рж╣ржЪрзНржЫрзЗ
- [ ] Inventory ржжрзЗржЦрзБржи - ржирж┐ржЬрзЗрж░ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Sales Report ржжрзЗржЦрзБржи - ржирж┐ржЬрзЗрж░ рж╕рзЗрж▓рж╕ ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Expense ржпрзЛржЧ ржХрж░рзБржи - ржирж┐ржЬрзЗрж░ ржжрзЛржХрж╛ржирзЗ рж╕рзЗржн рж╣ржЪрзНржЫрзЗ

### **рж╕рзНржЯрж╛ржл рж╣рж┐рж╕рзЗржмрзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи:**
- [ ] рж╕рзНржЯрж╛ржл ржЖржЗржбрж┐ ржжрж┐ржпрж╝рзЗ рж▓ржЧржЗржи ржХрж░рзБржи
- [ ] Dashboard ржжрзЗржЦрзБржи - **ржорж╛рж▓рж┐ржХрзЗрж░ ржбрзЗржЯрж╛** ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Billing ржХрж░рзБржи - **ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗ** рж╕рзЗржн рж╣ржЪрзНржЫрзЗ
- [ ] Inventory ржжрзЗржЦрзБржи - **ржорж╛рж▓рж┐ржХрзЗрж░ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ** ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Sales Report ржжрзЗржЦрзБржи - **ржорж╛рж▓рж┐ржХрзЗрж░ рж╕рзЗрж▓рж╕** ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ
- [ ] Expense ржпрзЛржЧ ржХрж░рзБржи (ржпржжрж┐ ржкрж╛рж░ржорж┐рж╢ржи ржерж╛ржХрзЗ) - **ржорж╛рж▓рж┐ржХрзЗрж░ ржжрзЛржХрж╛ржирзЗ** рж╕рзЗржн рж╣ржЪрзНржЫрзЗ

---

## ЁЯФН ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи

### **Browser Console-ржП ржЪрзЗржХ ржХрж░рзБржи:**

```javascript
// ржорж╛рж▓рж┐ржХ рж▓ржЧржЗржи ржХрж░рж╛рж░ ржкрж░
localStorage.getItem('activeShopId')
// Output: ржорж╛рж▓рж┐ржХрзЗрж░ ржирж┐ржЬрзЗрж░ UID

// рж╕рзНржЯрж╛ржл рж▓ржЧржЗржи ржХрж░рж╛рж░ ржкрж░
localStorage.getItem('activeShopId')
// Output: ржорж╛рж▓рж┐ржХрзЗрж░ UID (рж╕рзНржЯрж╛ржлрзЗрж░ ржирж┐ржЬрзЗрж░ UID ржиржпрж╝)

localStorage.getItem('userRole')
// Output: 'cashier' ржмрж╛ 'manager'

localStorage.getItem('isStaff')
// Output: 'true'
```

---

## тЭУ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи

### **рж╕ржорж╕рзНржпрж╛: "No active shop ID found"**
**рж╕ржорж╛ржзрж╛ржи:**
1. рж▓ржЧржЖржЙржЯ ржХрж░рзБржи
2. ржкрзБржирж░рж╛ржпрж╝ рж▓ржЧржЗржи ржХрж░рзБржи
3. localStorage ржХрзНрж▓рж┐ржпрж╝рж╛рж░ рж╣ржпрж╝рзЗ ржирждрзБржи `activeShopId` рж╕рзЗржЯ рж╣ржмрзЗ

### **рж╕ржорж╕рзНржпрж╛: рж╕рзНржЯрж╛ржл ржирж┐ржЬрзЗрж░ ржбрзЗржЯрж╛ ржжрзЗржЦржЫрзЗ**
**рж╕ржорж╛ржзрж╛ржи:**
1. Firestore Console ржЦрзБрж▓рзБржи
2. `staff_mapping` ржХрж╛рж▓рзЗржХрж╢ржирзЗ ржпрж╛ржи
3. рж╕рзНржЯрж╛ржлрзЗрж░ ржЗржорзЗржЗрж▓ (ржбржЯ рж╕рж░рж┐ржпрж╝рзЗ) ржжрж┐ржпрж╝рзЗ ржбржХрзБржорзЗржирзНржЯ ржЦрзБржБржЬрзБржи
4. `shopId` ржлрж┐рж▓рзНржбрзЗ ржорж╛рж▓рж┐ржХрзЗрж░ UID ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи

### **рж╕ржорж╕рзНржпрж╛: ржХрзЛржирзЛ ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ ржирж╛**
**рж╕ржорж╛ржзрж╛ржи:**
1. Browser Console ржЦрзБрж▓рзБржи (F12)
2. Error ржорзЗрж╕рзЗржЬ ржжрзЗржЦрзБржи
3. `activeShopId` undefined ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи
4. ржпржжрж┐ undefined рж╣ржпрж╝, рж▓ржЧржЖржЙржЯ ржХрж░рзЗ ржкрзБржирж░рж╛ржпрж╝ рж▓ржЧржЗржи ржХрж░рзБржи

---

## ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк

1. тЬЕ **рж╕ржм ржлрж╛ржЗрж▓ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ**
2. ЁЯзк **ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи** (ржорж╛рж▓рж┐ржХ ржПржмржВ рж╕рзНржЯрж╛ржл ржЙржнржпрж╝ рж╣рж┐рж╕рзЗржмрзЗ)
3. ЁЯФР **Firestore Security Rules ржЖржкржбрзЗржЯ ржХрж░рзБржи** (ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк)

---

## ЁЯУЭ ржирзЛржЯ

- рж╕ржм ржлрж╛ржЗрж▓рзЗ `currentUserId` ржПрж░ ржмржжрж▓рзЗ `activeShopId` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- рж▓ржЧржЗржи рж╕ржоржпрж╝ `localStorage.setItem('activeShopId', ...)` рж╕рзЗржЯ рж╣ржЪрзНржЫрзЗ
- ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗ `activeShopId` ржЪрзЗржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ, ржирж╛ ржерж╛ржХрж▓рзЗ рж▓ржЧржЗржи ржкрзЗржЬрзЗ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ рж╣ржЪрзНржЫрзЗ

---

**рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗржи:** Amazon Q Developer  
**рждрж╛рж░рж┐ржЦ:** рзирзжрзирзл-рзжрзз-рззрзл  
**рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕:** тЬЕ рж╕ржорзНржкрзВрж░рзНржг
