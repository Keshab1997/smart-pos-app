# ЁЯЪл Canceled Sales (ржмрж╛рждрж┐рж▓ржХрзГржд ржмрж┐ржХрзНрж░ржпрж╝) ржлрж┐ржЪрж╛рж░ - рж╕ржорзНржкрзВрж░рзНржг ржЧрж╛ржЗржб

## ЁЯУЛ ржлрж┐ржЪрж╛рж░ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк

ржПржЗ ржлрж┐ржЪрж╛рж░ржЯрж┐ ржЖржкржирж╛ржХрзЗ ржнрзБрж▓ ржмрж┐ржХрзНрж░ржпрж╝ ржмрж╛рждрж┐рж▓ ржХрж░рждрзЗ ржПржмржВ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржЗржиржнрзЗржирзНржЯрж░рж┐рждрзЗ рж╕рзНржЯржХ ржлрзЗрж░ржд ржкрж╛ржарж╛рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗред

---

## тЬи ржорзВрж▓ рж╕рзБржмрж┐ржзрж╛рж╕ржорзВрж╣

### 1. **рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж╕рзНржЯржХ рж░рж┐ржЯрж╛рж░рзНржи**
- ржмрж┐ржХрзНрж░ржпрж╝ ржмрж╛рждрж┐рж▓ ржХрж░рж▓рзЗ рж╕ржм ржкржгрзНржп рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржЗржиржнрзЗржирзНржЯрж░рж┐рждрзЗ ржлрзЗрж░ржд ржпрж╛ржмрзЗ
- ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ рж╕рзНржЯржХ ржпрзЛржЧ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ

### 2. **ржЖрж░рзНржерж┐ржХ рж░рж┐ржкрзЛрж░рзНржЯрж┐ржВ**
- ржмрж╛рждрж┐рж▓ржХрзГржд ржмрж┐ржХрзНрж░ржпрж╝ ржЖрж▓рж╛ржжрж╛ржнрж╛ржмрзЗ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рж╛ рж╣ржпрж╝
- ржорзЛржЯ ржмрж┐ржХрзНрж░ржпрж╝рзЗ ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝ ржпрзЛржЧ рж╣ржпрж╝ ржирж╛
- ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ ржЖржЬржХрзЗрж░ ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржкрж░рж┐ржорж╛ржг ржжрзЗржЦрж╛ ржпрж╛ржпрж╝

### 3. **ржЕржбрж┐ржЯ ржЯрзНрж░рзЗржЗрж▓**
- ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржмрж┐ржХрзНрж░ржпрж╝ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ ржорзБржЫрзЗ ржпрж╛ржпрж╝ ржирж╛
- ржмрж╛рждрж┐рж▓рзЗрж░ ржХрж╛рж░ржг ржПржмржВ рж╕ржоржпрж╝ рж╕ржВрж░ржХрзНрж╖рж┐ржд ржерж╛ржХрзЗ
- ржнржмрж┐рж╖рзНржпрждрзЗ рж░рзЗржлрж╛рж░рзЗржирзНрж╕рзЗрж░ ржЬржирзНржп рж╕ржм рждржерзНржп ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝

### 4. **ржирж┐рж░рж╛ржкрждрзНрждрж╛**
- ржмрж┐ржХрзНрж░ржпрж╝ ржмрж╛рждрж┐рж▓ ржХрж░рждрзЗ Master PIN ржкрзНрж░ржпрж╝рзЛржЬржи
- рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕржирзБржорзЛржжрж┐ржд ржмрзНржпржХрзНрждрж┐рж░рж╛ ржмрж┐ржХрзНрж░ржпрж╝ ржмрж╛рждрж┐рж▓ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи

---

## ЁЯОп ржХрзАржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи

### ржзрж╛ржк рзз: Sales Report ржкрзЗржЬрзЗ ржпрж╛ржи
```
Dashboard тЖТ Sales Report
```

### ржзрж╛ржк рзи: ржмрж┐ржХрзНрж░ржпрж╝ ржЦрзБржБржЬрзБржи
- ржЖржЬржХрзЗрж░ ржмрж┐ржХрзНрж░ржпрж╝ржЧрзБрж▓рзЛрждрзЗ "Cancel" ржмрж╛ржЯржи ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗржи
- ржкрзБрж░ржирзЛ ржмрж┐ржХрзНрж░ржпрж╝ржЧрзБрж▓рзЛ "Locked" ржерж╛ржХржмрзЗ (ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛)

### ржзрж╛ржк рзй: Cancel ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи
1. **Master PIN ржжрж┐ржи** - ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржпрж╛ржЪрж╛ржЗржпрж╝рзЗрж░ ржЬржирзНржп
2. **ржмрж╛рждрж┐рж▓рзЗрж░ ржХрж╛рж░ржг рж▓рж┐ржЦрзБржи** - ржпрзЗржоржи: "ржнрзБрж▓ ржмрж┐рж▓", "ржЧрзНрж░рж╛рж╣ржХ ржлрзЗрж░ржд ржжрж┐ржпрж╝рзЗржЫрзЗ"
3. **ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи** - "ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐ржд?" ржкрзНрж░ржорзНржкржЯрзЗ "OK" ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

### ржзрж╛ржк рзк: рж╕ржлрж▓ ржмрж╛рждрж┐рж▓ржХрж░ржг
тЬЕ рж╕ржлрж▓ рж╣рж▓рзЗ ржжрзЗржЦржмрзЗржи:
- ржмрж┐рж▓ржЯрж┐ рж▓рж╛рж▓ рж░ржЩрзЗ "CANCELED" ржорж╛рж░рзНржХ рж╣ржпрж╝рзЗ ржпрж╛ржмрзЗ
- рж╕рзНржЯржХ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржмрзЗржбрж╝рзЗ ржпрж╛ржмрзЗ
- рж╕рж╛ржорж╛рж░рж┐ ржмржХрзНрж╕рзЗ "Total Canceled" ржЖржкржбрзЗржЯ рж╣ржмрзЗ

---

## ЁЯФН ржлрж┐рж▓рзНржЯрж╛рж░ ржПржмржВ рж░рж┐ржкрзЛрж░рзНржЯ

### ржмрж╛рждрж┐рж▓ржХрзГржд ржмрж┐ржХрзНрж░ржпрж╝ ржжрзЗржЦрж╛рж░ ржЬржирзНржп:
1. Filter Section-ржП ржпрж╛ржи
2. "Canceled" ржЪрзЗржХржмржХрзНрж╕рзЗ ржЯрж┐ржХ ржжрж┐ржи
3. рж╢рзБржзрзБржорж╛рждрзНрж░ ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржмрж┐ржХрзНрж░ржпрж╝ржЧрзБрж▓рзЛ ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗржи

### рж╕ржм ржмрж┐ржХрзНрж░ржпрж╝ ржжрзЗржЦрж╛рж░ ржЬржирзНржп:
- рж╕ржм ржЪрзЗржХржмржХрзНрж╕ ржЯрж┐ржХ ржжрж┐ржи (Cash, Card, Online, Canceled)

### PDF рж░рж┐ржкрзЛрж░рзНржЯрзЗ:
- ржмрж╛рждрж┐рж▓ржХрзГржд ржмрж┐ржХрзНрж░ржпрж╝ "CANCELED" рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ рж╕рж╣ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗ
- ржЖрж▓рж╛ржжрж╛ рж░ржЩрзЗ рж╣рж╛ржЗрж▓рж╛ржЗржЯ ржХрж░рж╛ ржерж╛ржХржмрзЗ

---

## ЁЯУК ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ ржкрзНрж░ржнрж╛ржм

### ржЖржЬржХрзЗрж░ рж╕рзЗрж▓рж╕ ржХрж╛рж░рзНржб:
- тЬЕ рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕ржлрж▓ ржмрж┐ржХрзНрж░ржпрж╝ ржЧржгржирж╛ ржХрж░рж╛ рж╣ржпрж╝
- тЭМ ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝ ржпрзЛржЧ рж╣ржпрж╝ ржирж╛

### ржЖржЬржХрзЗрж░ ржмрж╛рждрж┐рж▓ ржХрж╛рж░рзНржб:
- ЁЯЪл ржЖржЬржХрзЗрж░ рж╕ржм ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржорзЛржЯ ржЯрж╛ржХрж╛ ржжрзЗржЦрж╛ржпрж╝

### ржкрзНрж░ржлрж┐ржЯ ржХрзНржпрж╛рж▓ржХрзБрж▓рзЗрж╢ржи:
- ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝ ржкрзНрж░ржлрж┐ржЯрзЗ ржЧржгржирж╛ ржХрж░рж╛ рж╣ржпрж╝ ржирж╛

---

## ЁЯЫбя╕П ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп

### 1. **Master PIN Protection**
- ржмрж┐ржХрзНрж░ржпрж╝ ржмрж╛рждрж┐рж▓ ржХрж░рждрзЗ PIN ржкрзНрж░ржпрж╝рзЛржЬржи
- PIN рж╕рзЗржЯрж┐ржВ: `settings/security` ржХрж╛рж▓рзЗржХрж╢ржирзЗ

### 2. **Time-Based Lock**
- рж╢рзБржзрзБржорж╛рждрзНрж░ ржЖржЬржХрзЗрж░ ржмрж┐ржХрзНрж░ржпрж╝ ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржпрж╛ржпрж╝
- ржкрзБрж░ржирзЛ ржмрж┐ржХрзНрж░ржпрж╝ "Locked" ржерж╛ржХрзЗ

### 3. **Reason Mandatory**
- ржмрж╛рждрж┐рж▓рзЗрж░ ржХрж╛рж░ржг рж▓рзЗржЦрж╛ ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ
- ржнржмрж┐рж╖рзНржпрждрзЗ ржЕржбрж┐ржЯрзЗрж░ ржЬржирзНржп рж╕ржВрж░ржХрзНрж╖рж┐ржд ржерж╛ржХрзЗ

---

## ЁЯЧДя╕П ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░

### Sales Document (ржмрж╛рждрж┐рж▓ ржХрж░рж╛рж░ ржкрж░):
```javascript
{
  id: "abc123",
  items: [...],
  total: 1500,
  status: "canceled",           // ржирждрзБржи ржлрж┐рж▓рзНржб
  canceledAt: Timestamp,        // ржмрж╛рждрж┐рж▓рзЗрж░ рж╕ржоржпрж╝
  cancelReason: "ржнрзБрж▓ ржмрж┐рж▓",      // ржмрж╛рждрж┐рж▓рзЗрж░ ржХрж╛рж░ржг
  createdAt: Timestamp,
  // ... ржЕржирзНржпрж╛ржирзНржп ржлрж┐рж▓рзНржб
}
```

### Inventory Update:
```javascript
// ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржкрзНрж░рждрж┐ржЯрж┐ ржЖржЗржЯрзЗржорзЗрж░ ржЬржирзНржп:
{
  stock: stock + quantity  // рж╕рзНржЯржХ ржмрзГржжрзНржзрж┐
}
```

---

## ЁЯОи UI/UX ржмрзИрж╢рж┐рж╖рзНржЯрзНржп

### рж░ржЩ ржХрзЛржбрж┐ржВ:
- ЁЯФ┤ **рж▓рж╛рж▓ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржб**: ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржмрж┐рж▓
- ЁЯФТ **Locked Badge**: ржкрзБрж░ржирзЛ ржмрж┐рж▓ (ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛)
- тЬЕ **рж╕ржмрзБржЬ**: рж╕ржлрж▓ ржмрж┐ржХрзНрж░ржпрж╝
- ЁЯЯб **рж╣рж▓рзБржж**: ржбрж┐рж╕ржХрж╛ржЙржирзНржЯ рж╕рж╣ ржмрж┐ржХрзНрж░ржпрж╝

### ржмрж╛ржЯржи рж╕рзНржЯрзЗржЯ:
- ржЖржЬржХрзЗрж░ ржмрж┐рж▓: тЬПя╕П Edit | ЁЯЦия╕П Print | ЁЯЧСя╕П Cancel
- ржкрзБрж░ржирзЛ ржмрж┐рж▓: ЁЯФТ Locked | ЁЯЦия╕П Print

---

## тЪая╕П ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржирзЛржЯ

### тЬЕ ржХрж░ржгрзАржпрж╝:
1. ржмрж╛рждрж┐рж▓ ржХрж░рж╛рж░ ржЖржЧрзЗ ржирж┐рж╢рзНржЪрж┐ржд рж╣ржи ржпрзЗ рж╕ржарж┐ржХ ржмрж┐рж▓ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗржЫрзЗржи
2. рж╕ржарж┐ржХ ржХрж╛рж░ржг рж▓рж┐ржЦрзБржи (ржнржмрж┐рж╖рзНржпрждрзЗ ржХрж╛ржЬрзЗ рж▓рж╛ржЧржмрзЗ)
3. ржирж┐ржпрж╝ржорж┐ржд ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ рж░рж┐ржкрзЛрж░рзНржЯ ржЪрзЗржХ ржХрж░рзБржи

### тЭМ ржХрж░ржгрзАржпрж╝ ржиржпрж╝:
1. ржПржХржЗ ржмрж┐рж▓ ржмрж╛рж░ржмрж╛рж░ ржмрж╛рждрж┐рж▓ ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░ржмрзЗржи ржирж╛
2. ржкрзБрж░ржирзЛ ржмрж┐рж▓ ржмрж╛рждрж┐рж▓ ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░ржмрзЗржи ржирж╛ (рж╕рж┐рж╕рзНржЯрзЗржо ржЕржирзБржорждрж┐ ржжрзЗржмрзЗ ржирж╛)
3. Master PIN рж╢рзЗржпрж╝рж╛рж░ ржХрж░ржмрзЗржи ржирж╛

---

## ЁЯФз ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ

### рж╕ржорж╕рзНржпрж╛: "This sale is already canceled" ржорзЗрж╕рзЗржЬ
**рж╕ржорж╛ржзрж╛ржи**: ржПржЗ ржмрж┐рж▓ржЯрж┐ ржЖржЧрзЗржЗ ржмрж╛рждрж┐рж▓ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред Canceled ржлрж┐рж▓рзНржЯрж╛рж░ ржжрж┐ржпрж╝рзЗ ржЪрзЗржХ ржХрж░рзБржиред

### рж╕ржорж╕рзНржпрж╛: Cancel ржмрж╛ржЯржи ржжрзЗржЦрж╛ ржпрж╛ржЪрзНржЫрзЗ ржирж╛
**рж╕ржорж╛ржзрж╛ржи**: 
- ржЪрзЗржХ ржХрж░рзБржи ржмрж┐рж▓ржЯрж┐ ржЖржЬржХрзЗрж░ ржХрж┐ржирж╛
- ржкрзБрж░ржирзЛ ржмрж┐рж▓ ржмрж╛рждрж┐рж▓ ржХрж░рж╛ ржпрж╛ржпрж╝ ржирж╛

### рж╕ржорж╕рзНржпрж╛: рж╕рзНржЯржХ ржЖржкржбрзЗржЯ рж╣ржЪрзНржЫрзЗ ржирж╛
**рж╕ржорж╛ржзрж╛ржи**:
- Inventory ржкрзЗржЬрзЗ ржЧрж┐ржпрж╝рзЗ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рзБржи
- ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржХрзНржпрж╛рж╢ ржХрзНрж▓рж┐ржпрж╝рж╛рж░ ржХрж░рзБржи

### рж╕ржорж╕рзНржпрж╛: PIN ржХрж╛ржЬ ржХрж░ржЫрзЗ ржирж╛
**рж╕ржорж╛ржзрж╛ржи**:
- Firebase Console тЖТ Firestore тЖТ shops/{userId}/settings/security
- `master_pin` ржлрж┐рж▓рзНржб ржЪрзЗржХ ржХрж░рзБржи

---

## ЁЯУИ ржнржмрж┐рж╖рзНржпржд ржЙржирзНржирждрж┐ (Roadmap)

- [ ] ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржЬржирзНржп ржЖрж▓рж╛ржжрж╛ рж░рж┐ржкрзЛрж░рзНржЯ ржкрзЗржЬ
- [ ] ржмрж╛рждрж┐рж▓рзЗрж░ ржХрж╛рж░ржг ржЕржирзБржпрж╛ржпрж╝рзА ржлрж┐рж▓рзНржЯрж╛рж░
- [ ] ржорж╛рж╕рж┐ржХ ржмрж╛рждрж┐рж▓ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржЯрзНрж░рзЗржирзНржб ржЪрж╛рж░рзНржЯ
- [ ] SMS/Email ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи (ржмрж╛рждрж┐рж▓рзЗрж░ рж╕ржоржпрж╝)
- [ ] Partial Cancel (ржХрж┐ржЫрзБ ржЖржЗржЯрзЗржо ржмрж╛рждрж┐рж▓ ржХрж░рж╛)

---

## ЁЯСитАНЁЯТ╗ ржбрзЗржнрзЗрж▓ржкрж╛рж░ ржирзЛржЯ

### ржлрж╛ржЗрж▓ ржкрж░рж┐ржмрж░рзНрждржи:
1. тЬЕ `sales-report/report.html` - UI ржЖржкржбрзЗржЯ
2. тЬЕ `sales-report/report.js` - Cancel рж▓ржЬрж┐ржХ
3. тЬЕ `sales-report/report.css` - Canceled рж╕рзНржЯрж╛ржЗрж▓
4. тЬЕ `js/dashboard.js` - Canceled tracking

### Firebase Transaction ржмрзНржпржмрж╣рж╛рж░:
```javascript
await runTransaction(db, async (t) => {
  // 1. Sale status ржЖржкржбрзЗржЯ
  // 2. Inventory stock ржмрзГржжрзНржзрж┐
  // ржЙржнржпрж╝ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрж╕рж╛ржерзЗ рж╕ржлрж▓ рж╣ржмрзЗ ржмрж╛ ржмрзНржпрж░рзНрже рж╣ржмрзЗ
});
```

---

## ЁЯУЮ рж╕рж╛ржкрзЛрж░рзНржЯ

ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ:
1. Browser Console ржЪрзЗржХ ржХрж░рзБржи (F12)
2. Firebase Console-ржП ржбрж╛ржЯрж╛ ржЪрзЗржХ ржХрж░рзБржи
3. ржПржЗ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржЖржмрж╛рж░ ржкржбрж╝рзБржи

---

**Developed by Keshab Sarkar**  
**Version**: 1.0  
**Last Updated**: 2024
